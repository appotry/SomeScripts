FROM alpine
LABEL AUTHOR="none"

ARG KEY="-----BEGIN OPENSSH PRIVATE KEY-----\n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\n-----END OPENSSH PRIVATE KEY-----"

ENV DEFAULT_LIST_FILE=crontab_list.sh \
        CUSTOM_LIST_MERGE_TYPE=append \
        COOKIES_LIST=/scripts/logs/cookies.list \
        REPO_URL=git@github.com:Aaron-lv/jd_scripts \
        REPO_BRANCH=master

RUN set -ex \
        && apk update && apk upgrade \
        && apk add --no-cache tzdata git nodejs moreutils npm curl jq openssh-client python3-dev py3-pip py3-cryptography py3-numpy py-pillow \
        && rm -rf /var/cache/apk/* \
        && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \
        && echo "Asia/Shanghai" > /etc/timezone \
        && mkdir -p /root/.ssh \
        && echo -e $KEY > /root/.ssh/id_rsa \
        && chmod 600 /root/.ssh/id_rsa \
        && ssh-keyscan github.com > /root/.ssh/known_hosts

RUN git clone -b $REPO_BRANCH $REPO_URL /scripts \
        && cd /scripts \
        && mkdir logs \
        && npm install \
        && cd /scripts/docker/bot \
        && pip3 install --upgrade pip \
        && pip3 install -r requirements.txt

RUN mkdir /jds \
        && cd /jds \
        && git init \
        && git remote add -f origin https://github.com/iouAkira/someDockerfile.git \
        && git config core.sparsecheckout true \
        && echo jd_scripts >> /jds/.git/info/sparse-checkout \
        && git pull origin master --rebase

RUN cp /jds/jd_scripts/docker_entrypoint.sh /usr/local/bin \
        && chmod +x /usr/local/bin/docker_entrypoint.sh

WORKDIR /scripts

ENTRYPOINT ["docker_entrypoint.sh"]

CMD [ "crond" ]